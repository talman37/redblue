<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="/layout/main_layout">
<th:block layout:fragment="content_body">
    <!-- container -->
    <div class="container-fluid">
        <!-- sidebar -->
        <nav class="sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <p class="sidebar-heading">법인관리</p>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/company">
                                    <i class="fas fa-search"></i>
                                    법인 검색
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link  active" href="/company/add">
                                    <i class="fas fa-pencil-alt"></i>
                                    법인 등록
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <p class="sidebar-heading">상담 관리</p>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link " href="/consult">
                                    <i class="fas fa-comment-alt"></i>
                                    상담 관리
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <p class="sidebar-heading">DM 관리</p>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/dm">
                                    <i class="fas fa-envelope-open-text"></i>
                                    DM 이력관리
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- //sidebar -->

        <!-- contents -->
        <main role="main" class="main">
            <div class="page-header">
                <div>
                    <h1>법인 등록</h1>
                </div>
            </div>
            <form th:id="company-form" th:name="company" th:action="@{/company/add}" method="post">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>법인</strong>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <input th:type="hidden" th:name="lawFirmId" th:value="${lawFirmId}">
                        <div class="row">
                            <div class="col-md-2 mb-2">
                                <label for="companyNumber1">법인등록번호</label>
                                <div class="input-group">
                                    <input type="text" class="form-control form-control-sm" id="companyNumber1" name="companyNumber1"
                                           required>
                                    <div class="invalid-feedback">
                                        Please provide a valid city.
                                    </div>
                                    <div class="input-group-addon">
                                        <span class="input-group-text">-</span>
                                    </div>
                                    <input type="text" class="form-control form-control-sm" name="companyNumber2" required>
                                </div>
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="registerNumber">등기번호</label>
                                <input type="text" class="form-control form-control-sm" id="registerNumber" name="registerNumber"
                                       value="">
                            </div>
                            <div class="col-md-2 mb-2">
                                <div class="d-flex justify-content-between">
                                    <label for="favorite_office">관할등기소</label>
                                    <button type="button" class="btn btn-sm btn-link p-0" data-toggle="modal"
                                            id="favorite_office"
                                            data-target="#modal-favorite">☆ 즐겨찾기
                                    </button>
                                </div>
                                <div class="input-group">
                                    <input type="text" class="form-control form-control-sm" id="registerOffice" name="registerOffice"
                                           th:readonly="true">
                                    <div class="input-group-append">
                                        <button type='button' id="office_search_btn" class="btn btn-sm btn-outline-secondary">
                                            검색
                                        </button>
                                    </div>
                                </div>
                                <div class="modal fade modal-favorite" id="modal-favorite">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">즐겨찾는 관할등기소</h5>
                                                <button type="button" class="close" data-dismiss="modal"
                                                        aria-label="Close">
                                                    <span aria-hidden="true">×</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="list-group">
                                                    <button type="button" class="list-group-item list-group-item-action"
                                                            th:each="favoriteOffice: ${favoriteOffices}"
                                                            th:id="${favoriteOffice.id.registerOfficeId}"
                                                            name="favoriteOffice" th:value="${favoriteOffice.name}"
                                                            th:text="${favoriteOffice.name}"
                                                            data-dismiss="modal"></button>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="companyDivision">법인구분</label>
                                <div class="input-group-prepend">
                                    <select class="form-select form-select-sm" id="companyDivision" name="companyDivision">
                                        <option selected value="">선택</option>
                                        <option value="주식회사">주식회사</option>
                                        <option value="유한회사">유한회사</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="displayCompanyTypeFront">법인 종류 표시</label>
                                <div class="mt-1">
                                    <div class="form-check form-check-inline">
                                        <div class="form-input">
                                                    <span class="input">
                                                        <input type="radio" id="displayCompanyTypeFront"
                                                               name="displayCompanyType" value="FRONT"><i></i>
                                                    </span>
                                            <label for="displayCompanyTypeFront">앞</label>
                                        </div>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <div class="form-input">
                                                    <span class="input">
                                                        <input type="radio" id="displayCompanyTypeBack"
                                                               name="displayCompanyType" value="BACK"><i></i>
                                                    </span>
                                            <label for="displayCompanyTypeBack">뒤</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="companyState">법인 상태</label>
                                <input type="text" class="form-control form-control-sm" id="companyState" name="companyState" value="">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="companyName">상호</label>
                                <input type="text" class="form-control form-control-sm" id="companyName" name="companyName" value="">
                            </div>
                            <div class="col-md-2 mb-2 input-daterange">
                                <label for="companyFormationAt">설립일</label>
                                <input type="text" class="form-control form-control-sm" id="companyFormationAt"
                                       name="companyFormationAt"
                                       value="">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="companySubName">병기 상호</label>
                                <input type="text" class="form-control form-control-sm" id="companySubName" name="companySubName"
                                       value="">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="companyManageState">관리 상태</label>
                                <input type="text" class="form-control form-control-sm" id="companyManageState"
                                       name="companyManageState" value="">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="companyManageNumber">관리 번호</label>
                                <input type="text" class="form-control form-control-sm" id="companyManageNumber"
                                       name="companyManageNumber" value="">
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="recommender">추천인</label>
                                <input type="text" class="form-control form-control-sm" id="recommender" name="recommender"
                                       placeholder="" value="">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>업장</strong>
                            </div>
                        </div>
                    </div>  
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-2">
                                <label for="companyAddress">본점주소</label>
                                <div class="input-group">
                                    <input type="text" class="form-control form-control-sm" id="companyAddress" name="companyAddress"
                                           value="">
                                    <div class="input-group-append">
                                        <button type='button' class="btn btn-sm btn-outline-secondary"
                                                name="postal_code_search_btn" data-id="companyAddress">검색
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="companyPostalCode">우편번호</label>
                                <input type="text" class="form-control form-control-sm" id="companyPostalCode" name="companyPostalCode"
                                       value="">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="deliveryPlace">송달장소</label>
                                <div class="input-group">
                                    <input type="text" class="form-control form-control-sm" id="deliveryPlace" name="deliveryPlace"
                                           value="">
                                    <div class="input-group-append">
                                        <button type='button' class="btn btn-sm btn-outline-secondary"
                                                name="postal_code_search_btn" data-id="deliveryPlace">검색
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 mb-2">
                                <label for="deliveryPlacePostalCode">우편번호</label>
                                <input type="text" class="form-control form-control-sm" id="deliveryPlacePostalCode"
                                       name="deliveryPlacePostalCode" value="">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2 mb-2">
                                <label for="businessNumber">사업자등록번호</label>
                                <input type="text" class="form-control form-control-sm" id="businessNumber" name="businessNumber"
                                       value="">
                            </div>
                            <div class="col-md-1 mb-2">
                                <label for="businessCondition">업태</label>
                                <input type="text" class="form-control form-control-sm" id="businessCondition" name="businessCondition"
                                       value="">
                            </div>
                            <div class="col-md-1 mb-2">
                                <label for="businessType">업종</label>
                                <input type="text" class="form-control form-control-sm" id="businessType" name="businessType" value="">
                            </div>
                            <div class="col-md-1 mb-2">
                                <label for="settlementMonth">결산기</label>
                                <select class="form-select form-select-sm" id="settlementMonth" name="settlementMonth">
                                    <option th:each="i : ${#numbers.sequence(1, 12)}" th:value="${i}"
                                            th:text="${i}+'월'"></option>
                                </select>
                            </div>
                            <div class="col-md-1 mb-2">
                                <label for="stockAmount">1주의 금액</label>
                                <input type="text" class="form-control form-control-sm" id="stockAmount" name="stock[amount]"
                                       numberonly="true">
                            </div>
                            <div class="col-md-1 mb-2">
                                <label for="stockScheduleCount">발행할 주식의 총수</label>
                                <input type="text" class="form-control form-control-sm" id="stockScheduleCount"
                                       name="stock[scheduleCount]" numberonly="true">
                            </div>
                            <div class="col-md-1 mb-2">
                                <label for="stockIssuedCount">발행주식의 총수</label>
                                <input type="text" class="form-control form-control-sm" id="stockIssuedCount"
                                       name="stock[issuedCount]" numberonly="true">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label for="capital">자본금</label>
                                <div class="input-group">
                                    <input type="text" class="form-control form-control-sm" id="capital" name="stock[capital]" value=""
                                           numberonly="true">
                                    <div class="input-group-append">
                                        <button type="button" class="btn btn-sm btn-outline-secondary"
                                                id="stock-calculate-btn">계산하기
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>연락처</strong>
                                    </div>
                                    <div>
                                        <button type='button' class='btn btn-sm btn-outline-primary' id="add-contact-btn">
                                            연락처 추가
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="add-item" id="contactGroup">
                                    <div class="row">
                                        <div class="col-md-9 mb-2">
                                            <label for="">연락처</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <select name="contacts[0][type]" class="form-select form-select-sm">
                                                        <option value="FACTORY">공장</option>
                                                        <option value="DIRECT_PHONE">직통번호</option>
                                                        <option value="MOBILE">휴대폰</option>
                                                        <option value="FAX">회사팩스</option>
                                                        <option value="EMAIL">이메일</option>
                                                        <option value="PHONE">유선전화</option>
                                                        <option value="TAX_EMAIL">세금계산서용 이메일</option>
                                                    </select>
                                                </div>
                                                <input type="text" class="form-control form-control-sm" name="contacts[0][value]">
                                            </div>
                                        </div>
                                        <div class="col-md-2 mb-2">
                                            <label for="">메모</label>
                                            <input type="text" class="form-control form-control-sm" name="contacts[0][memo]" placeholder="">
                                        </div>
                                        <div class="col-md-1 mb-2">
                                            <label for="">Actions</label>
                                            <div class="btns">
                                                <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                                        name="remove_contact_btn">
                                                    <i class="fas fa-trash-alt"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>지점</strong>
                                    </div>
                                    <div>
                                        <button type='button' class='btn btn-sm btn-outline-primary' id="add-branch-btn">
                                            지점 추가
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="add-item" id="branchGroup">
                                    <div class="row">
                                        <div class="col-md-2 mb-2">
                                            <label>지점명칭</label>
                                            <input type="text" class="form-control form-control-sm" name="branches[0][name]">
                                        </div>
                                        <div class="col-md-7 mb-2">
                                            <label>지점주소</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control form-control-sm" name="branches[0][address]">
                                                <div class="input-group-append">
                                                    <button type='button' class="btn btn-sm btn-sm btn-outline-secondary"
                                                            name="postal_code_search_btn" data-id="deliveryPlace">검색
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <label>우편번호</label>
                                            <input type="text" class="form-control form-control-sm"
                                                   name="branches[0][postalCode]" placeholder="">
                                        </div>
                                        <div class="col-md-1 mb-2">
                                            <label for="" class="invisible">Actions</label>
                                            <div class="btns">
                                                <button type="button" class="btn btn-sm btn-sm btn-sm btn-outline-secondary" onClick="remove_branch(0);" name="remove_branch_btn">
                                                    <i class="fas fa-trash-alt"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>임원</strong>
                                <strong class="text-primary" id="executiveCount"></strong>
                            </div>
                            <div>
                                <button type='button' class='btn btn-sm btn-outline-primary' id="add-executive-btn">
                                    임원 추가
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered mb-2 table-form">
                            <colgroup>
                                <col style="width: 100px"/>
                                <col/>
                                <col style="width: 210px"/>
                                <col/>
                                <col/>
                                <col style="width: 130px"/>
                                <col style="width: 130px"/>
                                <col style="width: 130px"/>
                                <col style="width: 130px"/>
                                <col/>
                                <col style="width: 50px"/>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>성명</th>
                                <th>직위</th>
                                <th>주민등록번호</th>
                                <th>국적</th>
                                <th>주소</th>
                                <th>취임일자</th>
                                <th>임기</th>
                                <th>임기만료일</th>
                                <th>주식수</th>
                                <th>임원에관한사항</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody id="executiveGroup">
                            <tr id="executive_tr_0">
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[0][name]" required>
                                </td>
                                <td>
                                    <select class="form-select form-select-sm" name="executives[0][position]">
                                        <option selected value="0">사내이사</option>
                                        <option value="1">대표이사</option>
                                        <option value="2">공동대표이사</option>
                                        <option value="3">대표집행임원</option>
                                        <option value="4">사외이사</option>
                                        <option value="5">기타비상무이사</option>
                                        <option value="6">집행임원</option>
                                        <option value="7">감사</option>
                                        <option value="8">감사위원</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="input-group">
                                        <input type="text" class="form-control form-control-sm"
                                               name="executives[0][registrationNumber1]" required>
                                        <div class="input-group-addon">
                                            <span class="input-group-text">-</span>
                                        </div>
                                        <input type="text" class="form-control form-control-sm"
                                               name="executives[0][registrationNumber2]" required>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                        <select  class="form-select form-select-sm" th:name="'executives[0][nationality]'" th:onchange="changeCountry(0)">
                                            <option th:each="country : ${countries}" th:text="${country.countryName}"></option>
                                        </select>
                                        <input type="text" class="form-control form-control-sm" th:readonly="true"
                                               th:name="'executives[0][countryValue]'">
                                    </div>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[0][address]" onclick="searchExecutiveAddress(0)" required>
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm" name="executives[0][inauguratedAt]" required>
                                </td>
                                <td>
                                    <select class="form-select form-select-sm" name="executives[0][term]" th:onchange="calcTerm(0)">
                                        <option selected value="0">직접입력</option>
                                        <option value="1">1년</option>
                                        <option value="2">2년</option>
                                        <option value="3">3년</option>
                                    </select>
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm" name="executives[0][expiredAt]" required>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[0][stockCount]"
                                           numberonly="true">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[0][detail]">
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                            onClick="remove_executive(0)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                    
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>주주</strong>
                                <strong class="text-primary" id="stockHolderCount"></strong>
                            </div>
                            <div>
                                <button type='button' class='btn btn-sm btn-outline-primary' id="add-stockHolder-btn">
                                    주주 추가
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="box-status">
                            <div class="item">
                                <div class="item-header">
                                    입력된 주식수
                                </div>
                                <div class="item-body">
                                    <span class='text-danger' id="input_stock_count">0</span>주
                                </div>
                            </div>
                            <div class="item">
                                <div class="item-header">
                                    발행주식총수
                                </div>
                                <div class="item-body">
                                    <span class='text-danger' id="issue_stock_count">0</span>주
                                </div>
                            </div>
                        </div>
                        <table class="table table-bordered mb-2 table-form">
                            <colgroup>
                                <col/>
                                <col/>
                                <col/>
                                <col/>
                                <col style="width: 50px"/>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>성명</th>
                                <th>주민등록번호</th>
                                <th>주소</th>
                                <th>주식수</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody id="stockHolderGroup">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>목적사항</strong>
                            </div>
                            <div>
                                <button type='button' class='btn btn-sm btn-outline-primary' id="add-purpose-btn">
                                    목적사항 추가
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="purposeGroup">
                            <div class="row">
                                <div class="col-md-11 mb-2">
                                    <input type="text" class="form-control form-control-sm" name="purposeDetail[0][detail]"
                                           id="purpose_detail"/>
                                    <input type="hidden" class="form-control form-control-sm" name="purposeDetail[0][ordinal]"/>
                                </div>
                                <div class="col-md-1 mb-2">
                                    <div class="btns">
                                        <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                                name="remove_purpose_btn">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="d-flex justify-content-center">
                        <div>
                            <button type="submit" class="btn  btn-dark" id="save-btn">저장하기</button>
                        </div>
                    </div>
                </div>
            </form>
        </main>
        <!-- //contents -->
    </div>
    <!-- //container -->

    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="text/javascript" th:src="@{/static/js/serializejson.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/jquery.tmpl.min.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/jquery.validate.min.js}"></script>
    <script>
        $(document).ready(function () {

            $('button[name="postal_code_search_btn"]').on('click', function () {
                var $this = $(this)
                daum.postcode.load(function () {
                    new daum.Postcode({
                        oncomplete: function (data) {
                            if ($this.data('id') == 'companyAddress') {
                                $('#companyAddress').val(data.address);
                                $('#companyPostalCode').val(data.zonecode);
                                $('#deliveryPlace').val(data.address);
                                $('#deliveryPlacePostalCode').val(data.zonecode);
                            } else {
                                $('#deliveryPlace').val(data.address);
                                $('#deliveryPlacePostalCode').val(data.zonecode);
                            }
                        }
                    }).open();
                });
            });

            $("#company-form").validate({
                errorPlacement: function(error, element) {
                },
                invalidHandler: function(form, validator) {
                     var errors = validator.numberOfInvalids();
                     if (errors) {
                         alert("필수 값을 입력하지 않으셨습니다.");
                         validator.errorList[0].element.focus();
                     }
                },
                submitHandler: function(form) {
                    $.ajax({
                        type: 'POST',
                        url: '/v1/companies',
                        contentType: 'application/json',
                        dataType: 'json',
                        data: JSON.stringify($('#company-form').serializeJSON({useIntKeysAsArrayIndex: true})),
                        success: location.href = '/company',
                        error: alert('법인 등록에 실패하였습니다.')
                    });
                    return false;
                }
            });

            $('#office_search_btn').on('click', function () {
                window.open('/office_search', '등기소검색', 'width=600px,height=800px,scrollbars=yes');
            });

            $('button[name="favoriteOffice"]').on('click', function () {
                $('#registerOffice').val($(this).val());

            });

<!--            $('#save-btn').on('click', function () {-->
<!--                if ($('#executiveGroup').children().length < 1) {-->
<!--                    alert("임원을 추가해 주세요.");-->
<!--                    return false;-->
<!--                }-->

<!--                $.ajax({-->
<!--                    type: 'POST',-->
<!--                    url: '/v1/companies',-->
<!--                    contentType: 'application/json',-->
<!--                    dataType: 'json',-->
<!--                    data: JSON.stringify($('#company-form').serializeJSON({useIntKeysAsArrayIndex: true})),-->
<!--                    success: location.href = '/company',-->
<!--                    error: alert('법인 등록에 실패하였습니다.')-->
<!--                });-->
<!--            });-->

            $('#add-contact-btn').on('click', function () {
                var i = $('#contactGroup > div').length
                $('#contact-template').tmpl([{index: i}]).appendTo($('#contactGroup'))
            });

            $('#stock-calculate-btn').on('click', function () {

                let amount = $('#stockAmount').val();
                if (amount == '') {
                    amount = 0;
                }
                let count = $('#stockIssuedCount').val();
                if (count == '') {
                    count = 0;
                }

                $('#capital').val(amount * count);

            });

            $('#expire-calculate-btn').on('click', function () {
                let expiredAt = new Date($('#inauguratedAt').val());
                expiredAt.setFullYear(expiredAt.getFullYear() + Number($('#term').val()));
                $('#expiredAt').val(getFormatDate(expiredAt))
            });

            $('#add-executive-btn').on('click', function () {
                let i = $('#executiveGroup > tr').length
                $('#executive-template').tmpl([{index: i}]).appendTo($('#executiveGroup'))
                $('.input-daterange').datepicker({
                    language: "ko",
                    todayHighlight: true
                });
            });

            $('#add-stockHolder-btn').on('click', function () {
                let i = $('#stockHolderGroup > tr').length;
                $('#stockHolder-template').tmpl([{index: i}]).appendTo($('#stockHolderGroup'))
            });

            $('#add-purpose-btn').on('click', function () {
                var i = $('#purposeGroup > div').length
                $('#purpose-template').tmpl([{index: i}]).appendTo($('#purposeGroup'))
            });

            $('#add-branch-btn').on('click', function () {
                var i = $('#branchGroup > div').length
                $('#branch-template').tmpl([{index: i}]).appendTo($('#branchGroup'))
            });


        });

        $('.input-daterange').datepicker({
            language: "ko",
            todayHighlight: true
        });

        $(document).on("keyup", "input:text[numberOnly]", function () {
            $(this).val($(this).val().replace(/[^0-9]/gi, ""));
        });

        function getFormatDate(date) {
            var year = date.getFullYear();
            var month = (1 + date.getMonth());
            month = month >= 10 ? month : '0' + month;
            var day = date.getDate();
            day = day >= 10 ? day : '0' + day;
            return year + '-' + month + '-' + day;
        }

        function remove_contact(i) {
            $('#contact_row_' + i).remove();
        }

        function remove_executive(i) {
            if (i === 0) {
                return false;
            }
            $('#executive_tr_' + i).remove();
        }

        function remove_stockHolder(i) {
            if (i === 0) {
                $('#stockHolderCount').text('');
            } else {
                $('#stockHolderCount').text(i);
            }
            var count = $('input[name="stockholders[' + i + '][stockCount]"]').val();
            if (count === '') {
                count = 0;
            }
            var inputCount = Number($('#input_stock_count').text()) - Number(count);
            var issueCount = Number($('#issue_stock_count').text()) - Number(count);
            $('#input_stock_count').text(inputCount);
            $('#issue_stock_count').text(issueCount);

            $('#stockHolder_tr_' + i).remove();
        }

        function remove_purpose(i) {
            $('#purpose_row_' + i).remove();
        }

        function changeCountry(i) {
            if($('select[name="executives['+i+'][nationality]"]').val() == '기타') {
                $('input[name="executives['+i+'][countryValue]"]').attr('readonly', false)
            } else {
                $('input[name="executives['+i+'][countryValue]"]').val('')
                $('input[name="executives['+i+'][countryValue]"]').attr('readonly', true)
            }
        }

        function calcTerm(i) {
            if($('input[name="executives['+i+'][term]"]').val() == '0') {
                return false;
            }
            let expiredAt = new Date($('input[name="executives['+i+'][inauguratedAt]"]').val());
            expiredAt.setFullYear(expiredAt.getFullYear() + Number($('select[name="executives['+i+'][term]"]').val()));
            $('input[name="executives['+i+'][expiredAt]"]').val(getFormatDate(expiredAt))
        }


        function remove_branch(i) {
            $('#branch_row_' + i).remove();
        }

        function searchExecutiveAddress(i) {
            var $this = $(this)
            daum.postcode.load(function () {
                new daum.Postcode({
                    oncomplete: function (data) {
                        $('input[name="executives['+i+'][address]"]').val(data.address)
                    }
                }).open();
            });
        }



    </script>

    <script id="contact-template" type="text/x-jQuery-tmpl">
        <div class="row" id="contact_row_{{= index}}">
            <div class="col-md-9 mb-2">
                <label for="">연락처</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <select name="contacts[{{= index}}][type]" class="form-select form-select-sm">
                            <option value="FACTORY">공장</option>
                            <option value="DIRECT_PHONE">직통번호</option>
                            <option value="MOBILE">휴대폰</option>
                            <option value="FAX">회사팩스</option>
                            <option value="EMAIL">이메일</option>
                            <option value="PHONE">유선전화</option>
                            <option value="TAX_EMAIL">세금계산서용 이메일</option>
                        </select>
                    </div>
                    <input type="text" class="form-control form-control-sm" name="contacts[{{= index}}][value]">
                </div>
            </div>
            <div class="col-md-2 mb-2">
                <label for="">메모</label>
                <input type="text" class="form-control form-control-sm" name="contacts[{{= index}}][memo]" placeholder="">
            </div>
            <div class="col-md-1 mb-2">
                <label for="" class="invisible">Actions</label>
                <div class="btns">
                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary" onClick="remove_contact({{= index}});" name="remove_contact_btn">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        </div>





    </script>
    <script id="executive-template" type="text/x-jQuery-tmpl">
        <tr id="executive_tr_{{= index}}">
            <td>
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][name]" style="width: 100%;" required>
            </td>
            <td>
                <select class="form-select form-select-sm" name="executives[{{= index}}][position]">
                    <option selected value="0">사내이사</option>
                    <option value="1">대표이사</option>
                    <option value="2">공동대표이사</option>
                    <option value="3">대표집행임원</option>
                    <option value="4">사외이사</option>
                    <option value="5">기타비상무이사</option>
                    <option value="6">집행임원</option>
                    <option value="7">감사</option>
                    <option value="8">감사위원</option>
                </select>
            </td>
            <td>
                <div class="input-group">
                    <input type="text" class="form-control form-control-sm"
                           name="executives[{{= index}}][registrationNumber1]" required>
                    <div class="input-group-addon">
                        <span class="input-group-text">-</span>
                    </div>
                    <input type="text" class="form-control form-control-sm"
                           name="executives[{{= index}}][registrationNumber2]" required>
                </div>
            </td>
            <td>
                <div class="input-group ">
                    <select class="form-select form-select-sm" name="executives[{{= index}}][nationality]" onchange="changeCountry({{= index}})">
                        <option value="대한민국">대한민국</option>
                        <option value="미합중국">미합중국</option>
                        <option value="중화인민공화국">중화인민공화국</option>
                        <option value="캐나다">캐나다</option>
                        <option value="일본">일본</option>
                        <option value="호주">호주</option>
                        <option value="홍콩">홍콩</option>
                        <option value="기타">기타</option>
                    </select>
                    <input type="text" class="form-control form-control-sm" readonly name="executives[{{= index}}][countryValue]">
                </div>
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][address]" style="width: 100%;" onclick="searchExecutiveAddress({{= index}})" required>
            </td>
            <td class="input-daterange">
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][inauguratedAt]" style="width: 100%;" required>
            </td>
            <td>
                <select class="form-select form-select-sm" name="executives[{{= index}}][term]" onchange="calcTerm({{= index}})">
                    <option selected value="0">직접입력</option>
                    <option value="1">1년</option>
                    <option value="2">2년</option>
                    <option value="3">3년</option>
                </select>
            </td>
            <td class="input-daterange">
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][expiredAt]" style="width: 100%;" required>
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][stockCount]" style="width: 100%;" numberonly="true">
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][detail]" style="width: 100%;">
            </td>
            <td>
                <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                        onClick="remove_executive({{= index}})">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        </tr>
    </script>
    <script id="stockHolder-template" type="text/x-jQuery-tmpl">
        <tr id="stockHolder_tr_{{= index}}">
            <td>
                <input type="text" class="form-control form-control-sm" name="stockholders[{{= index}}][name]" value="" />
            </td>
            <td>
                <div class="input-group">
                    <input type="text" class="form-control form-control-sm" name="stockholders[{{= index}}][registrationNumber1]" value=""/>
                    <div class="input-group-addon">
                        <span class="input-group-text">-</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" name="stockholders[{{= index}}][registrationNumber2]" value="" />
                </div>
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="stockholders[{{= index}}}][address]" value="" />
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="stockholders[{{= index}}][stockCount]" value="" />
            </td>
            <td>
                <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                        onClick="remove_stockHolder({{= index}})">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        </tr>
    </script>
    <script id="purpose-template" type="text/x-jQuery-tmpl">
        <div class="row" id="purpose_row_{{= index}}">
            <div class="col-md-11 mb-2">
                <input type="text" class="form-control form-control-sm" name="purposeDetail[{{= index}}][detail]"/>
                <input type="hidden" class="form-control form-control-sm" name="purposeDetail[{{= index}}][ordinal]"/>
            </div>
            <div class="col-md-1 mb-2">
                <div class="btns">
                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary" onClick="remove_purpose({{= index}});"
                            name="remove_purpose_btn">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </script>
    <script id="branch-template" type="text/x-jQuery-tmpl">
        <div class="row" id="branch_row_{{= index}}">
            <div class="col-md-2 mb-2">
                <label>지점명칭</label>
                <input type="text" class="form-control form-control-sm" name="branches[{{= index}}][name]">
            </div>
            <div class="col-md-7 mb-2">
                <label>지점주소</label>
                <div class="input-group">
                    <input type="text" class="form-control form-control-sm" name="branches[{{= index}}][address]">
                    <div class="input-group-append">
                        <button type='button' class="btn btn-sm btn-sm btn-outline-secondary"
                                name="postal_code_search_btn" data-id="deliveryPlace">검색
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <label>우편번호</label>
                <input type="text" class="form-control form-control-sm"
                       name="branches[{{= index}}][postalCode]" placeholder="">
            </div>
            <div class="col-md-1 mb-2">
                <label for="" class="invisible">Actions</label>
                <div class="btns">
                    <button type="button" class="btn btn-sm btn-sm btn-sm btn-outline-secondary" onClick="remove_branch({{= index}});" name="remove_branch_btn">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </script>

</th:block>
</html>