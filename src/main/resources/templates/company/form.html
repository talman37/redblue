<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="/layout/detail_layout">
<th:block layout:fragment="content_body">
    <!-- container -->
    <div class="container-fluid">
        <main role="main" class="main detail-company">
            <div class="page-header">
                <div>
                    <h1>법인 등록</h1>
                </div>
            </div>
            <form th:id="company-form" th:name="company" th:action="@{/company/add}" method="post">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>법인</strong>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <input th:type="hidden" th:name="lawFirmId" th:value="${lawFirmId}">
                        <table class="table-bordered">
                            <colgroup>
                                <col style="width: 70px;">
                                <col style="width: 150px;">
                                <col style="width: 90px;">
                                <col style="width: 150px;">
                                <col style="width: 70px;">
                                <col style="width: 185px;">
                                <col/>
                                <col style="width: 230px"/>
                            </colgroup>
                            <tbody>
                                <tr>
                                    <th style="background-color: #e3f2fd;">상호</th>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="companyName"
                                               name="companyName" value="">
                                    </td>
                                    <th>병기 상호</th>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="companySubName"
                                               name="companySubName"
                                               value="">
                                    </td>
                                    <th>법인구분</th>
                                    <td>
                                        <div class="d-flex">
                                            <select class="form-control form-select form-select-sm" id="companyDivision"
                                                    name="companyDivision">
                                                <option selected value="주식회사">주식회사</option>
                                                <option value="유한회사">유한회사</option>
                                                <option value="유한책임회사">유한책임회사</option>
                                                <option value="합자회사">합자회사</option>
                                                <option value="사단법인">사단법인</option>
                                                <option value="재단법인">재단법인</option>
                                                <option value="농업회사">농업회사</option>
                                                <option value="협동조합">협동조합</option>
                                                <option value="기타">기타</option>
                                            </select>
                                            <div class="form-check form-check-inline text-nowrap ml-2">
                                                <div class="form-input">
                                                        <span class="input">
                                                            <input type="radio" id="displayCompanyTypeFront"
                                                                   name="displayCompanyType" value="FRONT"><i></i>
                                                        </span>
                                                    <label for="displayCompanyTypeFront">앞</label>
                                                </div>
                                            </div>
                                            <div class="form-check form-check-inline text-nowrap">
                                                <div class="form-input">
                                                        <span class="input">
                                                            <input type="radio" id="displayCompanyTypeBack"
                                                                   name="displayCompanyType" value="BACK"><i></i>
                                                        </span>
                                                    <label for="displayCompanyTypeBack">뒤</label>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <th style="background-color: #e3f2fd;">관할등기소<br/>
                                        <button type="button" class="btn btn-sm btn-link p-0" data-toggle="modal"
                                                id="favorite_office"
                                                data-target="#modal-favorite">☆ 즐겨찾기
                                        </button>
                                        <div class="modal fade modal-favorite" id="modal-favorite">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">즐겨찾는 관할등기소</h5>
                                                        <button type="button" class="close" data-dismiss="modal"
                                                                aria-label="Close">
                                                            <span aria-hidden="true">×</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="list-group">
                                                            <button type="button" class="list-group-item list-group-item-action"
                                                                    th:each="favoriteOffice: ${favoriteOffices}"
                                                                    th:id="${favoriteOffice.id.registerOfficeId}"
                                                                    name="favoriteOffice" th:value="${favoriteOffice.name}"
                                                                    th:text="${favoriteOffice.name}"
                                                                    data-dismiss="modal"></button>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-sm btn-secondary"
                                                                data-dismiss="modal">
                                                            Close
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </th>
                                    <td>
                                        <div class="input-group">
                                            <input type="text" class="form-control form-control-sm" id="registerOffice"
                                                   name="registerOffice"
                                                   th:readonly="true">
                                            <div class="input-group-append">
                                                <button type='button' id="office_search_btn"
                                                        class="btn btn-sm btn-outline-secondary">
                                                    검색
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <table class="table-bordered">
                            <colgroup>
                                <col style="width: 70px;">
                                <col style="width: 110px;">
                                <col style="width: 90px;">
                                <col style="width: 120px;">
                                <col style="width: 70px;">
                                <col style="width: 100px;">
                                <col style="width: 60px;">
                                <col/>
                            </colgroup>
                            <tbody>
                                <tr>
                                    <th style="background-color: #e3f2fd;">등기번호</th>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="registerNumber"
                                               name="registerNumber" numberonly="true"
                                               value="">
                                    </td>
                                    <th>법인등록번호</th>
                                    <td>
                                        <input type="hidden" class="form-control form-control-sm" id="companyNumber1" name="companyNumber1">
                                        <input type="hidden" class="form-control form-control-sm" id="companyNumber2" name="companyNumber2" numberonly="true">
                                        <input type="text" class="form-control form-control-sm" id="companyNumber" name="companyNumber" required>
                                    </td>
                                    <th>관리 번호</th>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="companyManageNumber"
                                               name="companyManageNumber" value="">
                                    </td>
                                    <th>주의사항</th>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="precautions"
                                               name="precautions"
                                               placeholder="" value="">
                                    </td>
                                </tr>
                                <tr>
                                    <th>법인 상태</th>
                                    <td>
                                        <select class="form-control form-select form-select-sm" id="companyState"
                                                name="companyState">
                                            <option value="유효법인" selected>유효법인</option>
                                            <option value="본점전출(폐쇄)">본점전출(폐쇄)</option>
                                            <option value="해산(간주)">해산(간주)</option>
                                            <option value="조직변경해산">조직변경해산</option>
                                            <option value="청산종결(간주)">청산종결(간주)</option>
                                            <option value="법인회생">법인회생</option>
                                            <option value="법인파산">법인파산</option>
                                            <option value="기타폐쇄">기타폐쇄</option>
                                            <option value="기타">기타</option>
                                        </select>
                                    </td>
                                    <th>관리 상태</th>
                                    <td>
                                        <select class="form-control form-select form-select-sm" id="companyManageState" style="width:100px"
                                                name="companyManageState">
                                            <option selected value="신규법인">신규법인</option>
                                            <option value="관리법인">관리법인</option>
                                            <option value="관리종결(장기미등기)">관리종결(장기미등기)</option>
                                            <option value="관리종결(DM반송)">관리종결(DM반송)</option>
                                            <option value="관리종결(폐업)">관리종결(폐업)</option>
                                            <option value="관리종결(기타)">관리종결(기타)</option>
                                        </select>
                                    </td>
                                    <th>설립일</th>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="companyFormationAt"`
                                               name="companyFormationAt"
                                               value="">
                                    </td>
                                    <th>추천인</th>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" id="recommender"
                                               name="recommender"
                                               placeholder="" value="">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>업장</strong>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="table-bordered">
                            <tr>
                                <th>본점주소</th>
                                <td colspan="5">
                                    <div class="input-group">
                                        <input type="text" class="form-control form-control-sm" id="companyAddress"
                                           name="companyAddress"
                                           value="">
                                        <div class="input-group-append">
                                            <button type='button' class="btn btn-sm btn-outline-secondary"
                                                    name="postal_code_search_btn" data-id="companyAddress">검색
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <th>우편번호</th>
                                <td>
                                    <input type="text" class="form-control form-control-sm" id="companyPostalCode"
                                           name="companyPostalCode"
                                       value="">
                                </td>
                            </tr>
                            <tr>
                                <th>자본금</th>
                                <td>
                                    <div class="input-group">
                                        <input type="text" class="form-control form-control-sm" id="capital"
                                               name="stock[capital]" value="0"
                                               onkeyup="inputNumberFormat(this)">
                                        <div class="input-group-append">
                                            <button type="button" class="btn btn-sm btn-outline-secondary"
                                                    id="stock-calculate-btn">계산하기
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <th>1주의 금액</th>
                                <td>
                                    <input type="text" class="form-control form-control-sm" id="stockAmount"
                                           name="stock[amount]" value="0"
                                           onkeyup="inputNumberFormat(this)">
                                </td>
                                <th>발행주식<br/>총수</th>
                                <td>
                                    <input type="text" class="form-control form-control-sm" id="stockIssuedCount"
                                           name="stock[issuedCount]" value="0" onkeyup="inputNumberFormat(this)" onblur="reCalcRatio(this)">
                                </td>
                                <th>발행할 주식<br/>총수</th>
                                <td>
                                    <input type="text" class="form-control form-control-sm" id="stockScheduleCount"
                                           name="stock[scheduleCount]" value="0" onkeyup="inputNumberFormat(this)">
                                </td>
                            </tr>
                            <tr>
                                <th>결산기</th>
                                <td>
                                    <select class="form-control form-select form-select-sm" id="settlementMonth" style="width:50px"
                                            name="settlementMonth">
                                        <option value="1">1월</option>
                                        <option value="2">2월</option>
                                        <option value="3">3월</option>
                                        <option value="4">4월</option>
                                        <option value="5">5월</option>
                                        <option value="6">6월</option>
                                        <option value="7">7월</option>
                                        <option value="8">8월</option>
                                        <option value="9">9월</option>
                                        <option value="10">10월</option>
                                        <option value="11">11월</option>
                                        <option value="12" selected>12월</option>
                                    </select>
                                </td>
                                <th>사업자등록번호</th>
                                <td>
                                    <input type="text" class="form-control form-control-sm" id="businessNumber"
                                           name="businessNumber"
                                           value="">
                                </td>
                                <th>업태</th>
                                <td>
                                    <input type="text" class="form-control form-control-sm" id="businessCondition"
                                           name="businessCondition"
                                           value="">
                                </td>
                                <th>업종</th>
                                <td>
                                    <input type="text" class="form-control form-control-sm" id="businessType"
                                           name="businessType" value="">
                                </td>
                            </tr>
                            <tr>
                                <th>송달장소</th>
                                <td colspan="5">
                                    <div class="input-group">
                                        <input type="text" class="form-control form-control-sm" id="deliveryPlace" style="color:#0000FF;"
                                               name="deliveryPlace"
                                               value="">
                                        <div class="input-group-append">
                                            <button type='button' class="btn btn-sm btn-outline-secondary"
                                                    name="postal_code_search_btn" data-id="deliveryPlace">검색
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <th>우편번호</th>
                                <td>
                                    <input type="text" class="form-control form-control-sm" id="deliveryPlacePostalCode"
                                           name="deliveryPlacePostalCode" value="">
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>임원</strong>
                                <strong class="text-primary" id="executiveCount"></strong>
                            </div>
                            <div class="form-inline">
                                임기 :
                                <select class="form-control form-select form-select-sm ml-1 mr-1" id="select-term">
                                    <option value="1">1년</option>
                                    <option value="2">2년</option>
                                    <option value="3" selected>3년</option>
                                </select>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="add-executive-btn">
                                    임원 추가
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="box-status">
                            <div class="item">
                                <div class="item-header">
                                    입력된 주식수
                                </div>
                                <div class="item-body">
                                    <span class='text-danger' id="inputStockCount">0</span>주
                                </div>
                            </div>
                            <div class="item">
                                <div class="item-header">
                                    발행주식총수
                                </div>
                                <div class="item-body">
                                    <span class='text-danger' id="issueStockCount">0</span>주
                                </div>
                            </div>
                        </div>
                        <div class="table-scroll" style="max-height: 310px">
                        <table class="table table-bordered mb-2 table-form">
                            <colgroup>
                                <col style="width: 70px">
                                <col style="width: 80px">
                                <col style="width: 70px;">
                                <col style="width: 120px;">
                                <col>
                                <col style="width: 60px;">
                                <col style="width: 80px;">
                                <col style="width: 95px">
                                <col style="width: 95px">
                                <col style="width: 40px">
                            </colgroup>
                            <thead>
                            <tr>
                                <th>국적</th>
                                <th>직위</th>
                                <th>성명</th>
                                <th>주민등록번호</th>
                                <th>주소</th>
                                <th>주식비율(%)</th>
                                <th>주식수</th>
                                <th>취임일자</th>
                                <th>임기만료일</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody id="executiveGroup">
                            <tr id="executive_tr_0">
                                <td>
                                    <div class="d-flex flex-column">
                                        <select class="form-control form-select form-select-sm"
                                                th:name="'executives[0][nationality]'" th:onchange="changeCountry(0)">
                                            <option value="대한민국" selected></option>
                                            <option value="미합중국">미합중국</option>
                                            <option value="중화인민공화국">중화인민공화국</option>
                                            <option value="캐나다">캐나다</option>
                                            <option value="일본">일본</option>
                                            <option value="호주">호주</option>
                                            <option value="홍콩">홍콩</option>
                                            <option value="기타">기타</option>

                                        </select>
                                        <input type="text" class="form-control form-control-sm mt-1"  style="display:none" th:readonly="true"
                                               th:name="'executives[0][countryValue]'">
                                    </div>
                                </td>
                                <td>
                                    <select class="form-control form-select form-select-sm"
                                            name="executives[0][position]" th:onchange="changePosition(0)">
                                        <option selected value="사내이사">사내이사</option>
                                        <option value="감사">감사</option>
                                        <option value="대표이사">대표이사</option>
                                        <option value="사외이사">사외이사</option>
                                        <option value="기타비상무이사">기타비상무이사</option>
                                        <option value="공동대표이사">공동대표이사</option>
                                        <option value="이사">이사</option>
                                        <option value="집행임원">집행임원</option>
                                        <option value="대표집행임원">대표집행임원</option>
                                        <option value="감사위원">감사위원</option>
                                        <option value="주주">주주</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[0][name]" onblur="expireCopy(this, 0)">
                                </td>
                                <td>
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[0][registrationNumber1]">
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[0][registrationNumber2]">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[0][registrationNumber]">
                                </td>
                                <td>
                                    <textarea type="text" class="form-control form-control-sm"
                                           name="executives[0][address]"></textarea>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[0][stockRatio]" value="0" onblur="countCalculate(this, 0)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[0][stockCount]" value="0" onkeyup="inputNumberFormat(this)" onblur="ratioCalculate(this, 0)">
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[0][inauguratedAt]" onkeyup="inputDateFormat(this)" onblur="expireCalculate(this, 0)">
                                    <input type="hidden" name="executives[0][term]" value = "3"/>
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[0][expiredAt]" onkeyup="inputDateFormat(this)">
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                            onClick="remove_executive(0)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr id="executive_tr_1">
                                <td>
                                    <div class="d-flex flex-column">
                                        <select class="form-control form-select form-select-sm"
                                                th:name="'executives[1][nationality]'" th:onchange="changeCountry(1)">
                                            <option value="대한민국" selected></option>
                                            <option value="미합중국">미합중국</option>
                                            <option value="중화인민공화국">중화인민공화국</option>
                                            <option value="캐나다">캐나다</option>
                                            <option value="일본">일본</option>
                                            <option value="호주">호주</option>
                                            <option value="홍콩">홍콩</option>
                                            <option value="기타">기타</option>

                                        </select>
                                        <input type="text" class="form-control form-control-sm mt-1"  style="display:none" th:readonly="true"
                                               th:name="'executives[1][countryValue]'">
                                    </div>
                                </td>
                                <td>
                                    <select class="form-control form-select form-select-sm"
                                            name="executives[1][position]" th:onchange="changePosition(1)">
                                        <option selected value="사내이사">사내이사</option>
                                        <option value="감사">감사</option>
                                        <option value="대표이사">대표이사</option>
                                        <option value="사외이사">사외이사</option>
                                        <option value="기타비상무이사">기타비상무이사</option>
                                        <option value="공동대표이사">공동대표이사</option>
                                        <option value="이사">이사</option>
                                        <option value="집행임원">집행임원</option>
                                        <option value="대표집행임원">대표집행임원</option>
                                        <option value="감사위원">감사위원</option>
                                        <option value="주주">주주</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[1][name]" onblur="expireCopy(this, 1)">
                                </td>
                                <td>
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[1][registrationNumber1]">
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[1][registrationNumber2]">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[1][registrationNumber]">
                                </td>
                                <td>
                                    <textarea type="text" class="form-control form-control-sm"
                                              name="executives[1][address]"></textarea>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[1][stockRatio]" value="0" onblur="countCalculate(this, 1)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[1][stockCount]" value="0" onkeyup="inputNumberFormat(this)" onblur="ratioCalculate(this, 1)">
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[1][inauguratedAt]" onkeyup="inputDateFormat(this)" onblur="expireCalculate(this, 1)">
                                    <input type="hidden" name="executives[0][term]" value = "3"/>
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[1][expiredAt]" onkeyup="inputDateFormat(this)">
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                            onClick="remove_executive(1)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr id="executive_tr_2">
                                <td>
                                    <div class="d-flex flex-column">
                                        <select class="form-control form-select form-select-sm"
                                                th:name="'executives[2][nationality]'" th:onchange="changeCountry(2)">
                                            <option value="대한민국" selected></option>
                                            <option value="미합중국">미합중국</option>
                                            <option value="중화인민공화국">중화인민공화국</option>
                                            <option value="캐나다">캐나다</option>
                                            <option value="일본">일본</option>
                                            <option value="호주">호주</option>
                                            <option value="홍콩">홍콩</option>
                                            <option value="기타">기타</option>

                                        </select>
                                        <input type="text" class="form-control form-control-sm mt-1"  style="display:none" th:readonly="true"
                                               th:name="'executives[2][countryValue]'">
                                    </div>
                                </td>
                                <td>
                                    <select class="form-control form-select form-select-sm"
                                            name="executives[2][position]" th:onchange="changePosition(2)">
                                        <option selected value="사내이사">사내이사</option>
                                        <option value="감사">감사</option>
                                        <option value="대표이사">대표이사</option>
                                        <option value="사외이사">사외이사</option>
                                        <option value="기타비상무이사">기타비상무이사</option>
                                        <option value="공동대표이사">공동대표이사</option>
                                        <option value="이사">이사</option>
                                        <option value="집행임원">집행임원</option>
                                        <option value="대표집행임원">대표집행임원</option>
                                        <option value="감사위원">감사위원</option>
                                        <option value="주주">주주</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[2][name]" onblur="expireCopy(this, 2)">
                                </td>
                                <td>
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[2][registrationNumber1]">
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[2][registrationNumber2]">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[2][registrationNumber]">
                                </td>
                                <td>
                                    <textarea type="text" class="form-control form-control-sm"
                                              name="executives[2][address]"></textarea>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[2][stockRatio]" value="0" onblur="countCalculate(this, 2)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[2][stockCount]" value="0" onkeyup="inputNumberFormat(this)" onblur="ratioCalculate(this, 2)">
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[2][inauguratedAt]" onkeyup="inputDateFormat(this)" onblur="expireCalculate(this, 2)">
                                    <input type="hidden" name="executives[2][term]" value = "3"/>
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[2][expiredAt]" onkeyup="inputDateFormat(this)">
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                            onClick="remove_executive(2)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr id="executive_tr_3">
                                <td>
                                    <div class="d-flex flex-column">
                                        <select class="form-control form-select form-select-sm"
                                                th:name="'executives[3][nationality]'" th:onchange="changeCountry(3)">
                                            <option value="대한민국" selected></option>
                                            <option value="미합중국">미합중국</option>
                                            <option value="중화인민공화국">중화인민공화국</option>
                                            <option value="캐나다">캐나다</option>
                                            <option value="일본">일본</option>
                                            <option value="호주">호주</option>
                                            <option value="홍콩">홍콩</option>
                                            <option value="기타">기타</option>

                                        </select>
                                        <input type="text" class="form-control form-control-sm mt-1"  style="display:none" th:readonly="true"
                                               th:name="'executives[3][countryValue]'">
                                    </div>
                                </td>
                                <td>
                                    <select class="form-control form-select form-select-sm"
                                            name="executives[3][position]" th:onchange="changePosition(3)">
                                        <option selected value="사내이사">사내이사</option>
                                        <option value="감사">감사</option>
                                        <option value="대표이사">대표이사</option>
                                        <option value="사외이사">사외이사</option>
                                        <option value="기타비상무이사">기타비상무이사</option>
                                        <option value="공동대표이사">공동대표이사</option>
                                        <option value="이사">이사</option>
                                        <option value="집행임원">집행임원</option>
                                        <option value="대표집행임원">대표집행임원</option>
                                        <option value="감사위원">감사위원</option>
                                        <option value="주주">주주</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[3][name]" onblur="expireCopy(this, 3)">
                                </td>
                                <td>
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[3][registrationNumber1]">
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[3][registrationNumber2]">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[3][registrationNumber]">
                                </td>
                                <td>
                                    <textarea type="text" class="form-control form-control-sm"
                                              name="executives[3][address]"></textarea>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[3][stockRatio]" value="0" onblur="countCalculate(this, 3)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[3][stockCount]" value="0" onkeyup="inputNumberFormat(this)" onblur="ratioCalculate(this, 3)">
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[3][inauguratedAt]" onkeyup="inputDateFormat(this)" onblur="expireCalculate(this, 3)">
                                    <input type="hidden" name="executives[3][term]" value = "3"/>
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[3][expiredAt]" onkeyup="inputDateFormat(this)">
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                            onClick="remove_executive(3)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr id="executive_tr_4">
                                <td>
                                    <div class="d-flex flex-column">
                                        <select class="form-control form-select form-select-sm"
                                                th:name="'executives[4][nationality]'" th:onchange="changeCountry(4)">
                                            <option value="대한민국" selected></option>
                                            <option value="미합중국">미합중국</option>
                                            <option value="중화인민공화국">중화인민공화국</option>
                                            <option value="캐나다">캐나다</option>
                                            <option value="일본">일본</option>
                                            <option value="호주">호주</option>
                                            <option value="홍콩">홍콩</option>
                                            <option value="기타">기타</option>

                                        </select>
                                        <input type="text" class="form-control form-control-sm mt-1"  style="display:none" th:readonly="true"
                                               th:name="'executives[4][countryValue]'">
                                    </div>
                                </td>
                                <td>
                                    <select class="form-control form-select form-select-sm"
                                            name="executives[4][position]" th:onchange="changePosition(4)">
                                        <option selected value="사내이사">사내이사</option>
                                        <option value="감사">감사</option>
                                        <option value="대표이사">대표이사</option>
                                        <option value="사외이사">사외이사</option>
                                        <option value="기타비상무이사">기타비상무이사</option>
                                        <option value="공동대표이사">공동대표이사</option>
                                        <option value="이사">이사</option>
                                        <option value="집행임원">집행임원</option>
                                        <option value="대표집행임원">대표집행임원</option>
                                        <option value="감사위원">감사위원</option>
                                        <option value="주주">주주</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="executives[4][name]" onblur="expireCopy(this, 4)">
                                </td>
                                <td>
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[4][registrationNumber1]">
                                    <input type="hidden" class="form-control form-control-sm"
                                           name="executives[4][registrationNumber2]">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[4][registrationNumber]">
                                </td>
                                <td>
                                    <textarea type="text" class="form-control form-control-sm"
                                              name="executives[4][address]"></textarea>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[4][stockRatio]" value="0" onblur="countCalculate(this, 4)">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[4][stockCount]" value="0" onkeyup="inputNumberFormat(this)" onblur="ratioCalculate(this, 4)">
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[4][inauguratedAt]" onkeyup="inputDateFormat(this)" onblur="expireCalculate(this, 4)">
                                    <input type="hidden" name="executives[4][term]" value = "3"/>
                                </td>
                                <td class="input-daterange">
                                    <input type="text" class="form-control form-control-sm"
                                           name="executives[4][expiredAt]" onkeyup="inputDateFormat(this)">
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                            onClick="remove_executive(4)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>공고방법</strong>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="box-scrol">
                            <div class="row">
                                <input type="text" class="form-control form-control-sm" id="noticeWay"
                                       name="noticeWay"
                                       placeholder="" value="">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>목적사항</strong>
                            </div>
                            <div>
                                <button type='button' class='btn btn-sm btn-outline-primary' id="add-purpose-btn">
                                    목적사항 추가
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="box-scroll">
                            <div id="purposeGroup">
                                <div class="row">
                                    <div class="col-md mb-2">
                                        <input type="text" class="form-control form-control-sm"
                                               name="purposeDetail[0][detail]"
                                               id="purpose_detail"/>
                                        <input type="hidden" class="form-control form-control-sm"
                                               name="purposeDetail[0][ordinal]"/>
                                    </div>
                                    <div class="col-md-auto mb-2">
                                        <div class="btns">
                                            <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                                                    name="remove_purpose_btn">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>연락처</strong>
                                    </div>
                                    <div>
                                        <button type='button' class='btn btn-sm btn-outline-primary'
                                                id="add-contact-btn">
                                            연락처 추가
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-scroll">
                                    <table class="table table-bordered ">
                                        <colgroup>
                                            <col style="width: 100px;"/>
                                            <col/>
                                            <col style="width: 140px;"/>
                                            <col style="width: 40px"/>
                                        </colgroup>
                                        <thead>
                                        <tr>
                                            <th>구분</th>
                                            <th>연락처</th>
                                            <th>담당자/메모</th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody id="contactGroup">
<!--                                            <tr id="contact_row_0">-->
<!--                                                <td>-->
<!--                                                    <div class="input-group">-->
<!--                                                        <div class="input-group-prepend">-->
<!--                                                            <select name="contacts[0][type]"-->
<!--                                                                    class="form-control form-select form-select-sm">-->
<!--                                                                <option value="FACTORY">공장</option>-->
<!--                                                                <option value="DIRECT_PHONE">직통번호</option>-->
<!--                                                                <option value="MOBILE">휴대폰</option>-->
<!--                                                                <option value="FAX">회사팩스</option>-->
<!--                                                                <option value="EMAIL">이메일</option>-->
<!--                                                                <option value="PHONE">유선전화</option>-->
<!--                                                                <option value="TAX_EMAIL">세금계산서용 이메일</option>-->
<!--                                                            </select>-->
<!--                                                        </div>-->
<!--                                                        <input type="text" class="form-control form-control-sm"-->
<!--                                                               name="contacts[0][value]">-->
<!--                                                    </div>-->
<!--                                                </td>-->
<!--                                                <td>-->
<!--                                                    <input type="text" class="form-control form-control-sm"-->
<!--                                                           name="contacts[0][memo]" placeholder="">-->
<!--                                                </td>-->
<!--                                                <td>-->
<!--                                                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"-->
<!--                                                            name="remove_contact_btn" onclick="remove_contact(0)">-->
<!--                                                        <i class="fas fa-trash-alt"></i>-->
<!--                                                    </button>-->
<!--                                                </td>-->
<!--                                            </tr>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>지점</strong>
                                    </div>
                                    <div>
                                        <button type='button' class='btn btn-sm btn-outline-primary'
                                                id="add-branch-btn">
                                            지점 추가
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-scroll">
                                    <table class="table table-bordered">
                                        <colgroup>
                                            <col style="width: 100px"/>
                                            <col/>
                                            <col style="width: 40px"/>
                                        </colgroup>
                                        <thead>
                                        <tr>
                                            <th>지점명칭</th>
                                            <th>지점주소</th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody id="branchGroup">
<!--                                            <tr id="branch_row_0">-->
<!--                                                <td>-->
<!--                                                    <input type="text" class="form-control form-control-sm"-->
<!--                                                           name="branches[0][name]">-->
<!--                                                </td>-->
<!--                                                <td>-->
<!--                                                    <div class="input-group">-->
<!--                                                        <input type="text" class="form-control form-control-sm"-->
<!--                                                               name="branches[0][address]">-->
<!--                                                        <div class="input-group-append">-->
<!--                                                            <button type='button'-->
<!--                                                                    class="btn btn-sm btn-sm btn-outline-secondary"-->
<!--                                                                    onclick="search_address(0);">검색-->
<!--                                                            </button>-->
<!--                                                        </div>-->
<!--                                                    </div>-->
<!--                                                </td>-->
<!--                                                <td>-->
<!--                                                    <button type="button"-->
<!--                                                            class="btn btn-sm btn-sm btn-sm btn-outline-secondary" onclick="remove_branch(0)">-->
<!--                                                        <i class="fas fa-trash-alt"></i>-->
<!--                                                    </button>-->
<!--                                                </td>-->
<!--                                            </tr>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col">
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn  btn-dark" id="save-btn">저장하기</button>
                        </div>
                    </div>
                </div>
            </form>
        </main>
        <!-- //contents -->
    </div>
    <!-- //container -->

    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="text/javascript" th:src="@{/static/js/serializejson.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/jquery.tmpl.min.js}"></script>
    <script>
        $(document).ready(function () {

            $('button[name="postal_code_search_btn"]').on('click', function () {
                var $this = $(this)
                daum.postcode.load(function () {
                    new daum.Postcode({
                        oncomplete: function (data) {
                            if ($this.data('id') == 'companyAddress') {
                                $('#companyPostalCode').val(data.zonecode);
                                $('#deliveryPlacePostalCode').val(data.zonecode);
                            } else {
                                $('#deliveryPlacePostalCode').val(data.zonecode);
                            }
                        }
                    }).open();
                });
            });

            // $('#companyAddress').on('blur', function(){
            //     $('#deliveryPlace').val($(this).val());
            // });

            $('#office_search_btn').on('click', function () {
                window.open('/office_search', '등기소검색', 'width=600px,height=800px,scrollbars=yes');
            });

            $('button[name="favoriteOffice"]').on('click', function () {
                $('#registerOffice').val($(this).val());

            });

            $('#save-btn').on('click', function () {
                var btn = $(this);
                $(this).attr('disabled', true);

                if ($('#companyName').val() == '') {
                    alert("상호를 입력해 주세요.");
                    $(this).attr('disabled', false);
                    return false;
                }

                if ($('#registerNumber').val() == '') {
                    alert("등기번호를 입력해 주세요.");
                    $(this).attr('disabled', false);
                    return false;
                }

                if ($('#registerOffice').val() == '') {
                    alert("관할등기소를 입력해 주세요.");
                    $(this).attr('disabled', false);
                    return false;
                }

                if ($('#executiveGroup').children().length < 1) {
                    alert("임원을 추가해 주세요.");
                    $(this).attr('disabled', false);
                    return false;
                }

                if($('#companyNumber').val() != '') {
                    var companyNumber = $('#companyNumber').val().split('-');

                    if(companyNumber.length <= 1) {
                        alert("법인등록번호를 확인해주세요.");
                        $('#companyNumber').focus();
                        $(this).attr('disabled', false);
                        return false;
                    }
                    $('#companyNumber1').val(companyNumber[0]);
                    $('#companyNumber2').val(companyNumber[1]);
                }

                $.ajax({
                    url: "/v1/companies/duplicate-check?registerNumber="+$('#registerNumber').val()+"&registerOffice="+$('#registerOffice').val(),
                    method: "GET",
                    dataType: "json"
                }).done(function(data){
                    if(data) {
                        alert("이미 등록된 법인 입니다. 법인등록번호를 확인해주세요.");
                        btn.attr('disabled', false);
                        return false;
                    } else {
                        $('#stockAmount').val($('#stockAmount').val().replace(/\,/g,""));
                        $('#stockScheduleCount').val($('#stockScheduleCount').val().replace(/\,/g,""));
                        $('#stockIssuedCount').val($('#stockIssuedCount').val().replace(/\,/g,""));
                        $('#capital').val($('#capital').val().replace(/\,/g,""));

                        $("input[name$='[registrationNumber]']").each(function(i, el){
                            var registrationNumber = $(this).val().split("-");
                            $('input[name="executives[' + i + '][registrationNumber1]"]').val(registrationNumber[0]);
                            $('input[name="executives[' + i + '][registrationNumber2]"]').val(registrationNumber[1]);
                        });

                        $('input[name$="[stockCount]"]').each(function(i, el){
                            var count = uncomma($(this).val())
                            if(count > 0) {
                                $('input[name="executives[' + i + '][stockCount]"]').val(count);
                            }
                        });

                        $.ajax({
                            type: 'POST',
                            url: '/v1/companies',
                            contentType: 'application/json',
                            dataType: 'json',
                            data: JSON.stringify($('#company-form').serializeJSON({useIntKeysAsArrayIndex: true})),
                            statusCode: {
                                200: function () {
                                    alert('법인등록에 성공 하였습니다.');
                                    window.close();
                                    return false;
                                },
                                400: function () {
                                    alert('법인등록에 실패 하였습니다.');
                                    $(this).attr('disabled', false);
                                    return false;
                                },
                                500: function () {
                                    alert('법인등록에 실패 하였습니다.');
                                    $(this).attr('disabled', false);
                                    return false;
                                }
                            }
                        });
                        $("input[name$='[name]']").each(function(i, el){
                            if($(this).val() == '') {
                                $(this).parent().parent().remove();
                            }
                        });
                    }
                });

            });

            $('#add-contact-btn').on('click', function () {
                var i = $('#contactGroup > tr').length
                $('#contact-template').tmpl([{index: i}]).appendTo($('#contactGroup'))
            });

            $('#add-branch-btn').on('click', function () {
                let i = $('#branchGroup > tr').length
                $('#branch-template').tmpl([{index: i}]).appendTo($('#branchGroup'))
            });

            $('#stock-calculate-btn').on('click', function () {

                let amount = $('#stockAmount').val().replace(/\,/g,"");
                if (amount === '') {
                    amount = 0;
                }
                let issuedCount = $('#stockIssuedCount').val().replace(/\,/g,"");
                if (issuedCount === '') {
                    issuedCount = 0;
                }
                let scheduleCount = $('#stockScheduleCount').val().replace(/\,/g,"");
                if (scheduleCount === '') {
                    count = 0;
                }

                $('#capital').val(comma(amount * issuedCount));

            });

            $('#expire-calculate-btn').on('click', function () {
                let expiredAt = new Date($('#inauguratedAt').val());
                expiredAt.setFullYear(expiredAt.getFullYear() + Number($('#term').val()));
                $('#expiredAt').val(getFormatDate(expiredAt))
            });

            $('#add-executive-btn').on('click', function () {
                let i = $('#executiveGroup > tr').length;
                $('#executive-template').tmpl([{index: i}]).appendTo($('#executiveGroup'));
                let term = $('#select-term').val();
                $('input[name="executives[' + i + '][term]"]').val(term);
                // $('.input-daterange').datepicker({
                //     language: "ko",
                //     todayHighlight: true
                // });
            });

            $('#add-purpose-btn').on('click', function () {
                var i = $('#purposeGroup > div').length
                $('#purpose-template').tmpl([{index: i}]).appendTo($('#purposeGroup'))
            });

            $('#select-term').on('change', function(){
                var term = $(this).val();
                $("input[name$='[term]']").each(function(i, el){
                    $(this).val(term);
                });
                $("input[name$='[inauguratedAt]']").each(function(i, el){
                    expireCalculate(el, i);
                });

            });

        });

        // $('.input-daterange').datepicker({
        //     language: "ko",
        //     todayHighlight: true
        // });

        $(document).on("keyup", "input:text[numberOnly]", function () {
            $(this).val($(this).val().replace(/[^0-9]/gi, ""));
        });

        function expireCopy(obj, i) {
            if(obj.value === '') {
                return false;
            }
            let position = $('select[name="executives[' + i + '][position]"]').val();
            let term = $('#select-term').val();
            if(position === '대표이사' || position === '공동대표이사') {
                var name = $('input[name="executives[' + i + '][name]"]').val();
                $("input[name$='[name]']").each(function(index, el){
                    var targetPosition = $('select[name="executives[' + index + '][position]"]').val();
                    if($(this).val() == name && targetPosition == '사내이사' ) {
                        $('input[name="executives[' + i + '][expiredAt]"]').val($('input[name="executives[' + index + '][expiredAt]"]').val());
                    }
                });

            }
            if(position === '대표집행임원') {
                var name = $('input[name="executives[' + i + '][name]"]').val();
                $("input[name$='[name]']").each(function(index, el){
                    var targetPosition = $('select[name="executives[' + index + '][position]"]').val();
                    if($(this).val() == name && targetPosition == '집행임원' ) {
                        $('input[name="executives[' + i + '][expiredAt]"]').val($('input[name="executives[' + index + '][expiredAt]"]').val());
                    }
                });
            }
            $('input[name="executives[' + i + '][term]"]').val(term);
        }

        function expireCalculate(obj, i) {
            if(obj.value === '') {
                return false;
            }
            let expiredAt = new Date(obj.value);
            let term = $('#select-term').val();
            let position = $('select[name="executives[' + i + '][position]"]').val();

            if(position === '감사') {
                let settlementMonth = $('#settlementMonth').val();
                let inauguratedYear = expiredAt.getFullYear();
                let meetingDate = new Date(inauguratedYear + 2, settlementMonth, 0);

                expiredAt.setFullYear(expiredAt.getFullYear() + 2);
                if(expiredAt >= meetingDate) {
                    meetingDate.setFullYear(meetingDate.getFullYear() + 1);
                }
                meetingDate = addMonth(meetingDate, 3);
                $('input[name="executives[' + i + '][expiredAt]"]').val(getFormatDate(meetingDate));
            } else if(position === '대표이사' || position === '공동대표이사') {
                var name = $('input[name="executives[' + i + '][name]"]').val();
                $("input[name$='[name]']").each(function(index, el){
                    var targetPosition = $('select[name="executives[' + index + '][position]"]').val();
                    if($(this).val() == name && targetPosition == '사내이사') {
                        $('input[name="executives[' + i + '][expiredAt]"]').val($('input[name="executives[' + index + '][expiredAt]"]').val());
                    }
                });
            } else if(position === '대표집행임원' ) {
                var name = $('input[name="executives[' + i + '][name]"]').val();
                $("input[name$='[name]']").each(function(index, el){
                    var targetPosition = $('select[name="executives[' + index + '][position]"]').val();
                    if($(this).val() == name && targetPosition == '집행임원') {
                        $('input[name="executives[' + i + '][expiredAt]"]').val($('input[name="executives[' + index + '][expiredAt]"]').val());
                    }
                });
            } else if(position === '사내이사') {
                expiredAt.setFullYear(expiredAt.getFullYear() + Number(term));
                $('input[name="executives[' + i + '][expiredAt]"]').val(getFormatDate(expiredAt));
                var name = $('input[name="executives[' + i + '][name]"]').val();
                $("input[name$='[name]']").each(function(index, el){
                    var targetPosition = $('select[name="executives[' + index + '][position]"]').val();
                    if($(this).val() == name && targetPosition == '대표이사') {
                        $('input[name="executives[' + index + '][expiredAt]"]').val(getFormatDate(expiredAt));
                    }
                    if($(this).val() == name && targetPosition == '공동대표이사') {
                        $('input[name="executives[' + index + '][expiredAt]"]').val(getFormatDate(expiredAt));
                    }
                });
            } else if(position === '집행임원') {
                expiredAt.setFullYear(expiredAt.getFullYear() + Number(term));
                $('input[name="executives[' + i + '][expiredAt]"]').val(getFormatDate(expiredAt));
                var name = $('input[name="executives[' + i + '][name]"]').val();
                $("input[name$='[name]']").each(function(index, el){
                    var targetPosition = $('select[name="executives[' + index + '][position]"]').val();
                    if($(this).val() == name && targetPosition == '대표집행임원') {
                        $('input[name="executives[' + index + '][expiredAt]"]').val(getFormatDate(expiredAt));
                    }
                });
            } else {
                expiredAt.setFullYear(expiredAt.getFullYear() + Number(term));
                $('input[name="executives[' + i + '][expiredAt]"]').val(getFormatDate(expiredAt));
            }
            $('input[name="executives[' + i + '][term]"]').val(term);
        }

        function addMonth(date, month) {
            let addMonthFirstDate = new Date(
                date.getFullYear(),
                date.getMonth() + month,
                1
            );

            let addMonthLastDate = new Date(
                addMonthFirstDate.getFullYear(),
                addMonthFirstDate.getMonth() + 1
                , 0
            );

            // let result = addMonthFirstDate;
            // if(date.getDate() > addMonthLastDate.getDate())
            // {
            //     result.setDate(addMonthLastDate.getDate());
            // }
            // else
            // {
            //     result.setDate(date.getDate());
            // }

            return addMonthLastDate;
        }

        function getFormatDate(date) {
            var year = date.getFullYear();
            var month = (1 + date.getMonth());
            month = month >= 10 ? month : '0' + month;
            var day = date.getDate();
            day = day >= 10 ? day : '0' + day;
            return year + '-' + month + '-' + day;
        }

        function remove_contact(i) {
            $('#contact_row_' + i).remove();
        }

        function remove_executive(i) {
            $('#executive_tr_' + i).remove();
        }

        function remove_purpose(i) {
            $('#purpose_row_' + i).remove();
        }

        function remove_branch(i) {
            $('#branch_row_' + i).remove();
        }

        function search_address(i) {
            daum.postcode.load(function () {
                new daum.Postcode({
                    oncomplete: function (data) {
                        $('input[name="branches[' + i + '][address]"]').val(data.address);
                        $('input[name="branches[' + i + '][postalCode]"]').val(data.zonecode);
                    }
                }).open();
            });
        }

        function changeCountry(i) {
            if ($('select[name="executives[' + i + '][nationality]"]').val() == '기타') {
                $('input[name="executives['+i+'][countryValue]"]').show();
                $('input[name="executives['+i+'][countryValue]"]').attr('readonly', false)
            } else {
                $('input[name="executives['+i+'][countryValue]"]').hide();
                $('input[name="executives[' + i + '][countryValue]"]').val('')
                $('input[name="executives['+i+'][countryValue]"]').attr('readonly', true)
            }
        }

        function inputNumberFormat(obj) {
            obj.value = comma(uncomma(obj.value));
        }

        function comma(str) {
            str = String(str);
            return str.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
        }

        function uncomma(str) {
            str = String(str);
            return str.replace(/[^\d]+/g, '');
        }

        function inputDateFormat(obj) {
            obj.value = hyphen(obj.value);
        }

        function hyphen(str) {
            str = String(str);
            return str.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3');
        }

        function ratioCalculate(obj, i) {
            if(obj.value === '') {
                return false;
            }
            var count = uncomma(obj.value);
            var stockIssuedCount = uncomma($('#stockIssuedCount').val());
            var calcValue = count / stockIssuedCount;
            if(isNaN(calcValue)) {
                calcValue = 0;
            }
            var ratio = calcValue * 100;
            $('input[name="executives[' + i + '][stockRatio]"]').val( Math.floor(ratio * 1000) / 1000);
            this.sumInputStockCount();
        }

        function countCalculate(obj, i) {
            if(obj.value === '') {
                return false;
            }
            var ratio = obj.value;
            var stockIssuedCount = uncomma($('#stockIssuedCount').val());
            var count = stockIssuedCount * ratio / 100;
            $('input[name="executives[' + i + '][stockCount]"]').val(comma(Math.floor(count)));
            this.sumInputStockCount();
        }

        function reCalcRatio(obj) {
            var stockIssuedCount = uncomma(obj.value);
            $('#issueStockCount').text(obj.value);
            $('input[name$="[stockCount]"]').each(function(i, el){
                var count = uncomma($(this).val());
                if(count > 0) {
                    var ratio = count / stockIssuedCount * 100;
                    $('input[name="executives[' + i + '][stockRatio]"]').val(Math.floor(ratio * 1000) / 1000);
                }
            });
            this.sumInputStockCount();
        }

        function sumInputStockCount() {
            var total = 0;
            $('input[name$="[stockCount]"]').each(function(i, el){
                total += Number(uncomma($(this).val()));
            });
            $('#inputStockCount').text(comma(Math.floor(total)));
        }

        function changePosition(i) {
            $('input[name="executives[' + i + '][inauguratedAt]"]').each(function(i, el) {
                expireCalculate(el, i);
            });
        }


    </script>

    <script id="contact-template" type="text/x-jQuery-tmpl">
        <tr id="contact_row_{{= index}}">
            <td>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <select name="contacts[{{= index}}][type]" class="form-control form-select form-select-sm">
                            <option value="FACTORY">공장</option>
                            <option value="DIRECT_PHONE">직통번호</option>
                            <option value="MOBILE">휴대폰</option>
                            <option value="FAX">회사팩스</option>
                            <option value="EMAIL">이메일</option>
                            <option value="PHONE">유선전화</option>
                            <option value="TAX_EMAIL">세금용 메일</option>
                        </select>
                    </div>
                </div>
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="contacts[{{= index}}][value]">
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="contacts[{{= index}}][memo]" placeholder="">
            </td>
            <td>
                <button type="button" class="btn btn-sm btn-sm btn-outline-secondary" onClick="remove_contact({{= index}});" name="remove_contact_btn">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        </tr>
    </script>
    <script id="branch-template" type="text/x-jQuery-tmpl">
        <tr id="branch_row_{{= index}}">
            <td>
                <input type="text" class="form-control form-control-sm" name="branches[{{= index}}][name]">
            </td>
            <td>
                <div class="input-group">
                    <input type="text" class="form-control form-control-sm" name="branches[{{= index}}][address]">
                    <div class="input-group-append">
                        <button type='button' class="btn btn-sm btn-sm btn-outline-secondary"
                                name="postal_code_search_btn" onClick="search_address({{= index}});">검색
                        </button>
                    </div>
                </div>
                <input type="hidden" class="form-control form-control-sm" style="width: 55px" name="branches[{{= index}}][postalCode]" placeholder="">
            </td>
            <td>
                <button type="button" class="btn btn-sm btn-sm btn-sm btn-outline-secondary" onClick="remove_branch({{= index}});" name="remove_branch_btn">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        </tr>
    </script>
    <script id="executive-template" type="text/x-jQuery-tmpl">
        <tr id="executive_tr_{{= index}}">
            <td>
                <div class="d-flex flex-column">
                    <select class="form-control form-select form-select-sm" name="executives[{{= index}}][nationality]" onchange="changeCountry({{= index}});">
                        <option value="대한민국"></option>
                        <option value="미합중국">미합중국</option>
                        <option value="중화인민공화국">중화인민공화국</option>
                        <option value="캐나다">캐나다</option>
                        <option value="일본">일본</option>
                        <option value="호주">호주</option>
                        <option value="홍콩">홍콩</option>
                        <option value="기타">기타</option>
                    </select>
                    <input type="text" class="form-control form-control-sm mt-1"  style="display:none" readonly name="executives[{{= index}}][countryValue]">
                </div>
            </td>
            <td>
                <select class="form-control form-select form-select-sm" name="executives[{{= index}}][position]" onchange="changePosition({{= index}});">
                    <option selected value="사내이사">사내이사</option>
                    <option value="감사">감사</option>
                    <option value="대표이사">대표이사</option>
                    <option value="사외이사">사외이사</option>
                    <option value="기타비상무이사">기타비상무이사</option>
                    <option value="공동대표이사">공동대표이사</option>
                    <option value="이사">이사</option>
                    <option value="집행임원">집행임원</option>
                    <option value="대표집행임원">대표집행임원</option>
                    <option value="감사위원">감사위원</option>
                    <option value="주주">주주</option>
                </select>
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][name]" style="width: 100%;" onblur="expireCopy(this, {{= index}})">
            </td>
            <td>
                <input type="hidden" class="form-control form-control-sm"
                       name="executives[{{= index}}][registrationNumber1]">
                <input type="hidden" class="form-control form-control-sm"
                       name="executives[{{= index}}][registrationNumber2]">
                <input type="text" class="form-control form-control-sm"
                       name="executives[{{= index}}][registrationNumber]">
            </td>
            <td>
                <textarea type="text" class="form-control form-control-sm" name="executives[{{= index}}][address]" style="width: 100%;"></textarea>
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][stockRatio]" style="width: 100%;" value="0" onblur="countCalculate(this, {{= index}})">
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][stockCount]" style="width: 100%;" value="0" onkeyup="inputNumberFormat(this)" onblur="ratioCalculate(this, {{= index}})">
            </td>
            <td class="input-daterange">
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][inauguratedAt]" style="width: 100%;" onkeyup="inputDateFormat(this)" onblur="expireCalculate(this, {{= index}})">
                <input type="hidden" name="executives[{{= index}}][term]" value="3">
            </td>
            <td class="input-daterange">
                <input type="text" class="form-control form-control-sm" name="executives[{{= index}}][expiredAt]" style="width: 100%;" onkeyup="inputDateFormat(this)">
            </td>
            <td>
                <button type="button" class="btn btn-sm btn-sm btn-outline-secondary"
                        onClick="remove_executive({{= index}})">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        </tr>
    </script>
    <script id="purpose-template" type="text/x-jQuery-tmpl">
        <div class="row" id="purpose_row_{{= index}}">
            <div class="col-md mb-2">
                <input type="text" class="form-control form-control-sm" name="purposeDetail[{{= index}}][detail]"/>
                <input type="hidden" class="form-control form-control-sm" name="purposeDetail[{{= index}}][ordinal]"/>
            </div>
            <div class="col-md-auto mb-2">
                <div class="btns">
                    <button type="button" class="btn btn-sm btn-sm btn-outline-secondary" onClick="remove_purpose({{= index}});"
                            name="remove_purpose_btn">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </script>

</th:block>
</html>